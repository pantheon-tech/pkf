{"version":3,"sources":["../src/cli.ts"],"sourcesContent":["#!/usr/bin/env node\r\n\r\n/**\r\n * PKF Validator CLI\r\n * Command-line interface for validating PKF configurations and documents\r\n */\r\n\r\nimport { Command } from 'commander';\r\nimport chalk from 'chalk';\r\nimport { validateConfig } from './validators/config-validator.js';\r\nimport { validateTodo } from './validators/todo-validator.js';\r\nimport { validateIssues } from './validators/issue-validator.js';\r\nimport { validateChangelog } from './validators/changelog-validator.js';\r\nimport { validateAll } from './index.js';\r\nimport type { ValidationResult, ValidationIssue } from './types/index.js';\r\n\r\nconst program = new Command();\r\n\r\nprogram\r\n  .name('pkf-validator')\r\n  .description('PKF Validation CLI - validates PKF configuration and documentation')\r\n  .version('1.0.0');\r\n\r\n/**\r\n * Format and print validation results\r\n */\r\nfunction printResults(result: ValidationResult, verbose: boolean = false): void {\r\n  const { valid, errors, warnings, info, duration, itemCount } = result;\r\n\r\n  // Print header\r\n  if (valid) {\r\n    console.log(chalk.green.bold('\\n✓ Validation passed'));\r\n  } else {\r\n    console.log(chalk.red.bold('\\n✗ Validation failed'));\r\n  }\r\n\r\n  // Print statistics\r\n  const stats: string[] = [];\r\n  if (itemCount !== undefined) {\r\n    stats.push(`${itemCount} item(s) checked`);\r\n  }\r\n  if (duration !== undefined) {\r\n    stats.push(`${duration}ms`);\r\n  }\r\n  if (stats.length > 0) {\r\n    console.log(chalk.dim(`  ${stats.join(' • ')}`));\r\n  }\r\n\r\n  // Print issues\r\n  if (errors.length > 0) {\r\n    console.log(chalk.red(`\\n${errors.length} error(s):`));\r\n    printIssues(errors, 'red');\r\n  }\r\n\r\n  if (warnings.length > 0) {\r\n    console.log(chalk.yellow(`\\n${warnings.length} warning(s):`));\r\n    printIssues(warnings, 'yellow');\r\n  }\r\n\r\n  if (verbose && info.length > 0) {\r\n    console.log(chalk.blue(`\\n${info.length} info:`));\r\n    printIssues(info, 'blue');\r\n  }\r\n\r\n  console.log('');\r\n}\r\n\r\n/**\r\n * Print a list of validation issues\r\n */\r\nfunction printIssues(issues: ValidationIssue[], color: 'red' | 'yellow' | 'blue'): void {\r\n  const colorFn = chalk[color];\r\n\r\n  for (const issue of issues) {\r\n    const location = issue.filePath\r\n      ? issue.line\r\n        ? `${issue.filePath}:${issue.line}`\r\n        : issue.filePath\r\n      : '';\r\n\r\n    console.log(colorFn(`  • [${issue.code}] ${issue.message}`));\r\n    if (location) {\r\n      console.log(chalk.dim(`    at ${location}`));\r\n    }\r\n    if (issue.suggestion) {\r\n      console.log(chalk.dim(`    → ${issue.suggestion}`));\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Common options for all validate commands\r\n */\r\ninterface ValidateOptions {\r\n  verbose?: boolean;\r\n  json?: boolean;\r\n}\r\n\r\n/**\r\n * Handle validation result output\r\n */\r\nfunction handleResult(result: ValidationResult, options: ValidateOptions): void {\r\n  if (options.json) {\r\n    console.log(JSON.stringify(result, null, 2));\r\n  } else {\r\n    printResults(result, options.verbose);\r\n  }\r\n\r\n  // Exit with appropriate code\r\n  process.exit(result.valid ? 0 : 1);\r\n}\r\n\r\n// Validate all command\r\nprogram\r\n  .command('validate')\r\n  .description('Run all validators')\r\n  .option('-v, --verbose', 'Show detailed output including info messages')\r\n  .option('--json', 'Output results as JSON')\r\n  .option('-r, --root <path>', 'Root directory (default: current directory)')\r\n  .action(async (options: ValidateOptions & { root?: string }) => {\r\n    try {\r\n      const rootDir = options.root || process.cwd();\r\n      const result = await validateAll({ rootDir });\r\n      handleResult(result, options);\r\n    } catch (error) {\r\n      console.error(chalk.red(`Error: ${(error as Error).message}`));\r\n      process.exit(2);\r\n    }\r\n  });\r\n\r\n// Validate config command\r\nprogram\r\n  .command('validate:config')\r\n  .description('Validate pkf.config.yaml')\r\n  .option('-v, --verbose', 'Show detailed output')\r\n  .option('--json', 'Output results as JSON')\r\n  .option('-c, --config <path>', 'Path to config file')\r\n  .action(async (options: ValidateOptions & { config?: string }) => {\r\n    try {\r\n      const result = await validateConfig({ configPath: options.config });\r\n      handleResult(result, options);\r\n    } catch (error) {\r\n      console.error(chalk.red(`Error: ${(error as Error).message}`));\r\n      process.exit(2);\r\n    }\r\n  });\r\n\r\n// Validate TODO command\r\nprogram\r\n  .command('validate:todo')\r\n  .description('Validate TODO.md register')\r\n  .option('-v, --verbose', 'Show detailed output')\r\n  .option('--json', 'Output results as JSON')\r\n  .option('-f, --file <path>', 'Path to TODO.md file')\r\n  .action(async (options: ValidateOptions & { file?: string }) => {\r\n    try {\r\n      const todoPath = options.file ?? 'docs/registers/TODO.md';\r\n      const result = await validateTodo(todoPath);\r\n      handleResult(result, options);\r\n    } catch (error) {\r\n      console.error(chalk.red(`Error: ${(error as Error).message}`));\r\n      process.exit(2);\r\n    }\r\n  });\r\n\r\n// Validate issues command\r\nprogram\r\n  .command('validate:issues')\r\n  .description('Validate ISSUES.md register')\r\n  .option('-v, --verbose', 'Show detailed output')\r\n  .option('--json', 'Output results as JSON')\r\n  .option('-f, --file <path>', 'Path to ISSUES.md file')\r\n  .action(async (options: ValidateOptions & { file?: string }) => {\r\n    try {\r\n      const issuesPath = options.file ?? 'docs/registers/ISSUES.md';\r\n      const result = await validateIssues(issuesPath);\r\n      handleResult(result, options);\r\n    } catch (error) {\r\n      console.error(chalk.red(`Error: ${(error as Error).message}`));\r\n      process.exit(2);\r\n    }\r\n  });\r\n\r\n// Validate changelog command\r\nprogram\r\n  .command('validate:changelog')\r\n  .description('Validate CHANGELOG.md register')\r\n  .option('-v, --verbose', 'Show detailed output')\r\n  .option('--json', 'Output results as JSON')\r\n  .option('-f, --file <path>', 'Path to CHANGELOG.md file')\r\n  .action(async (options: ValidateOptions & { file?: string }) => {\r\n    try {\r\n      const changelogPath = options.file ?? 'docs/registers/CHANGELOG.md';\r\n      const result = await validateChangelog(changelogPath);\r\n      handleResult(result, options);\r\n    } catch (error) {\r\n      console.error(chalk.red(`Error: ${(error as Error).message}`));\r\n      process.exit(2);\r\n    }\r\n  });\r\n\r\n// Parse and execute\r\nprogram.parse();\r\n"],"mappings":";;;;;;;;;;AAOA,SAAS,eAAe;AACxB,OAAO,WAAW;AAQlB,IAAM,UAAU,IAAI,QAAQ;AAE5B,QACG,KAAK,eAAe,EACpB,YAAY,oEAAoE,EAChF,QAAQ,OAAO;AAKlB,SAAS,aAAa,QAA0B,UAAmB,OAAa;AAC9E,QAAM,EAAE,OAAO,QAAQ,UAAU,MAAM,UAAU,UAAU,IAAI;AAG/D,MAAI,OAAO;AACT,YAAQ,IAAI,MAAM,MAAM,KAAK,4BAAuB,CAAC;AAAA,EACvD,OAAO;AACL,YAAQ,IAAI,MAAM,IAAI,KAAK,4BAAuB,CAAC;AAAA,EACrD;AAGA,QAAM,QAAkB,CAAC;AACzB,MAAI,cAAc,QAAW;AAC3B,UAAM,KAAK,GAAG,SAAS,kBAAkB;AAAA,EAC3C;AACA,MAAI,aAAa,QAAW;AAC1B,UAAM,KAAK,GAAG,QAAQ,IAAI;AAAA,EAC5B;AACA,MAAI,MAAM,SAAS,GAAG;AACpB,YAAQ,IAAI,MAAM,IAAI,KAAK,MAAM,KAAK,UAAK,CAAC,EAAE,CAAC;AAAA,EACjD;AAGA,MAAI,OAAO,SAAS,GAAG;AACrB,YAAQ,IAAI,MAAM,IAAI;AAAA,EAAK,OAAO,MAAM,YAAY,CAAC;AACrD,gBAAY,QAAQ,KAAK;AAAA,EAC3B;AAEA,MAAI,SAAS,SAAS,GAAG;AACvB,YAAQ,IAAI,MAAM,OAAO;AAAA,EAAK,SAAS,MAAM,cAAc,CAAC;AAC5D,gBAAY,UAAU,QAAQ;AAAA,EAChC;AAEA,MAAI,WAAW,KAAK,SAAS,GAAG;AAC9B,YAAQ,IAAI,MAAM,KAAK;AAAA,EAAK,KAAK,MAAM,QAAQ,CAAC;AAChD,gBAAY,MAAM,MAAM;AAAA,EAC1B;AAEA,UAAQ,IAAI,EAAE;AAChB;AAKA,SAAS,YAAY,QAA2B,OAAwC;AACtF,QAAM,UAAU,MAAM,KAAK;AAE3B,aAAW,SAAS,QAAQ;AAC1B,UAAM,WAAW,MAAM,WACnB,MAAM,OACJ,GAAG,MAAM,QAAQ,IAAI,MAAM,IAAI,KAC/B,MAAM,WACR;AAEJ,YAAQ,IAAI,QAAQ,aAAQ,MAAM,IAAI,KAAK,MAAM,OAAO,EAAE,CAAC;AAC3D,QAAI,UAAU;AACZ,cAAQ,IAAI,MAAM,IAAI,UAAU,QAAQ,EAAE,CAAC;AAAA,IAC7C;AACA,QAAI,MAAM,YAAY;AACpB,cAAQ,IAAI,MAAM,IAAI,cAAS,MAAM,UAAU,EAAE,CAAC;AAAA,IACpD;AAAA,EACF;AACF;AAaA,SAAS,aAAa,QAA0B,SAAgC;AAC9E,MAAI,QAAQ,MAAM;AAChB,YAAQ,IAAI,KAAK,UAAU,QAAQ,MAAM,CAAC,CAAC;AAAA,EAC7C,OAAO;AACL,iBAAa,QAAQ,QAAQ,OAAO;AAAA,EACtC;AAGA,UAAQ,KAAK,OAAO,QAAQ,IAAI,CAAC;AACnC;AAGA,QACG,QAAQ,UAAU,EAClB,YAAY,oBAAoB,EAChC,OAAO,iBAAiB,8CAA8C,EACtE,OAAO,UAAU,wBAAwB,EACzC,OAAO,qBAAqB,6CAA6C,EACzE,OAAO,OAAO,YAAiD;AAC9D,MAAI;AACF,UAAM,UAAU,QAAQ,QAAQ,QAAQ,IAAI;AAC5C,UAAM,SAAS,MAAM,YAAY,EAAE,QAAQ,CAAC;AAC5C,iBAAa,QAAQ,OAAO;AAAA,EAC9B,SAAS,OAAO;AACd,YAAQ,MAAM,MAAM,IAAI,UAAW,MAAgB,OAAO,EAAE,CAAC;AAC7D,YAAQ,KAAK,CAAC;AAAA,EAChB;AACF,CAAC;AAGH,QACG,QAAQ,iBAAiB,EACzB,YAAY,0BAA0B,EACtC,OAAO,iBAAiB,sBAAsB,EAC9C,OAAO,UAAU,wBAAwB,EACzC,OAAO,uBAAuB,qBAAqB,EACnD,OAAO,OAAO,YAAmD;AAChE,MAAI;AACF,UAAM,SAAS,MAAM,eAAe,EAAE,YAAY,QAAQ,OAAO,CAAC;AAClE,iBAAa,QAAQ,OAAO;AAAA,EAC9B,SAAS,OAAO;AACd,YAAQ,MAAM,MAAM,IAAI,UAAW,MAAgB,OAAO,EAAE,CAAC;AAC7D,YAAQ,KAAK,CAAC;AAAA,EAChB;AACF,CAAC;AAGH,QACG,QAAQ,eAAe,EACvB,YAAY,2BAA2B,EACvC,OAAO,iBAAiB,sBAAsB,EAC9C,OAAO,UAAU,wBAAwB,EACzC,OAAO,qBAAqB,sBAAsB,EAClD,OAAO,OAAO,YAAiD;AAC9D,MAAI;AACF,UAAM,WAAW,QAAQ,QAAQ;AACjC,UAAM,SAAS,MAAM,aAAa,QAAQ;AAC1C,iBAAa,QAAQ,OAAO;AAAA,EAC9B,SAAS,OAAO;AACd,YAAQ,MAAM,MAAM,IAAI,UAAW,MAAgB,OAAO,EAAE,CAAC;AAC7D,YAAQ,KAAK,CAAC;AAAA,EAChB;AACF,CAAC;AAGH,QACG,QAAQ,iBAAiB,EACzB,YAAY,6BAA6B,EACzC,OAAO,iBAAiB,sBAAsB,EAC9C,OAAO,UAAU,wBAAwB,EACzC,OAAO,qBAAqB,wBAAwB,EACpD,OAAO,OAAO,YAAiD;AAC9D,MAAI;AACF,UAAM,aAAa,QAAQ,QAAQ;AACnC,UAAM,SAAS,MAAM,eAAe,UAAU;AAC9C,iBAAa,QAAQ,OAAO;AAAA,EAC9B,SAAS,OAAO;AACd,YAAQ,MAAM,MAAM,IAAI,UAAW,MAAgB,OAAO,EAAE,CAAC;AAC7D,YAAQ,KAAK,CAAC;AAAA,EAChB;AACF,CAAC;AAGH,QACG,QAAQ,oBAAoB,EAC5B,YAAY,gCAAgC,EAC5C,OAAO,iBAAiB,sBAAsB,EAC9C,OAAO,UAAU,wBAAwB,EACzC,OAAO,qBAAqB,2BAA2B,EACvD,OAAO,OAAO,YAAiD;AAC9D,MAAI;AACF,UAAM,gBAAgB,QAAQ,QAAQ;AACtC,UAAM,SAAS,MAAM,kBAAkB,aAAa;AACpD,iBAAa,QAAQ,OAAO;AAAA,EAC9B,SAAS,OAAO;AACd,YAAQ,MAAM,MAAM,IAAI,UAAW,MAAgB,OAAO,EAAE,CAAC;AAC7D,YAAQ,KAAK,CAAC;AAAA,EAChB;AACF,CAAC;AAGH,QAAQ,MAAM;","names":[]}