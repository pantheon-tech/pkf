{"version":3,"sources":["../src/commands/init.ts"],"sourcesContent":["/**\r\n * Init Command\r\n * Scaffolds PKF in a new or existing project\r\n */\r\n\r\nimport { existsSync, mkdirSync, writeFileSync, copyFileSync } from 'node:fs';\r\nimport { join, dirname } from 'node:path';\r\nimport { fileURLToPath } from 'node:url';\r\nimport chalk from 'chalk';\r\n\r\nconst __dirname = dirname(fileURLToPath(import.meta.url));\r\n\r\ninterface InitOptions {\r\n  yes?: boolean;\r\n  template?: 'minimal' | 'standard' | 'full';\r\n}\r\n\r\nconst TEMPLATES = {\r\n  minimal: {\r\n    description: 'Basic PKF setup with essential files only',\r\n    files: ['pkf.config.yaml', 'docs/README.md', 'docs/registers/TODO.md'],\r\n  },\r\n  standard: {\r\n    description: 'Standard PKF setup with guides and registers',\r\n    files: [\r\n      'pkf.config.yaml',\r\n      'CLAUDE.md',\r\n      'docs/README.md',\r\n      'docs/INDEX',\r\n      'docs/guides/README.md',\r\n      'docs/registers/README.md',\r\n      'docs/registers/TODO.md',\r\n      'docs/registers/ISSUES.md',\r\n      'docs/registers/CHANGELOG.md',\r\n    ],\r\n  },\r\n  full: {\r\n    description: 'Full PKF setup with all directories and lifecycle support',\r\n    files: [\r\n      'pkf.config.yaml',\r\n      'CLAUDE.md',\r\n      'docs/README.md',\r\n      'docs/INDEX',\r\n      'docs/guides/README.md',\r\n      'docs/guides/INDEX',\r\n      'docs/architecture/README.md',\r\n      'docs/architecture/active/README.md',\r\n      'docs/architecture/archived/README.md',\r\n      'docs/proposals/README.md',\r\n      'docs/proposals/draft/README.md',\r\n      'docs/proposals/active/README.md',\r\n      'docs/proposals/archived/README.md',\r\n      'docs/registers/README.md',\r\n      'docs/registers/TODO.md',\r\n      'docs/registers/ISSUES.md',\r\n      'docs/registers/CHANGELOG.md',\r\n    ],\r\n  },\r\n};\r\n\r\nexport async function initCommand(options: InitOptions): Promise<void> {\r\n  const template = options.template || 'standard';\r\n  const cwd = process.cwd();\r\n\r\n  console.log(chalk.bold('\\nPKF - Project Knowledge Framework\\n'));\r\n\r\n  // Check if PKF is already initialized\r\n  if (existsSync(join(cwd, 'pkf.config.yaml'))) {\r\n    console.log(chalk.yellow('⚠ PKF is already initialized in this project.'));\r\n    console.log(chalk.gray('  To reinitialize, remove pkf.config.yaml first.\\n'));\r\n    return;\r\n  }\r\n\r\n  console.log(chalk.cyan(`Initializing PKF with ${chalk.bold(template)} template...\\n`));\r\n  console.log(chalk.gray(`  ${TEMPLATES[template as keyof typeof TEMPLATES].description}\\n`));\r\n\r\n  // Create directories and files\r\n  const files = TEMPLATES[template as keyof typeof TEMPLATES].files;\r\n  let created = 0;\r\n\r\n  for (const file of files) {\r\n    const filePath = join(cwd, file);\r\n    const dir = dirname(filePath);\r\n\r\n    // Create directory if needed\r\n    if (!existsSync(dir)) {\r\n      mkdirSync(dir, { recursive: true });\r\n    }\r\n\r\n    // Create file with template content\r\n    if (!existsSync(filePath)) {\r\n      const content = getTemplateContent(file, cwd);\r\n      writeFileSync(filePath, content);\r\n      console.log(chalk.green(`  ✓ Created ${file}`));\r\n      created++;\r\n    } else {\r\n      console.log(chalk.gray(`  - Skipped ${file} (already exists)`));\r\n    }\r\n  }\r\n\r\n  console.log(chalk.bold.green(`\\n✓ PKF initialized successfully!`));\r\n  console.log(chalk.gray(`  Created ${created} files\\n`));\r\n\r\n  console.log(chalk.bold('Next steps:'));\r\n  console.log(chalk.gray('  1. Edit pkf.config.yaml to customize your documentation structure'));\r\n  console.log(chalk.gray('  2. Run `pkf build` to generate validation artifacts'));\r\n  console.log(chalk.gray('  3. Run `pkf validate` to check your documentation\\n'));\r\n}\r\n\r\nfunction getTemplateContent(file: string, cwd: string): string {\r\n  const projectName = cwd.split('/').pop() || 'my-project';\r\n\r\n  if (file === 'pkf.config.yaml') {\r\n    return `# PKF Configuration\r\n# Documentation: https://github.com/anthropics/pkf\r\n\r\nversion: \"1.0.0\"\r\n\r\nproject:\r\n  name: ${projectName}\r\n  description: Project documentation\r\n\r\noutput:\r\n  dir: .pkf/generated\r\n\r\ndocs:\r\n  _type: root\r\n  _readme: true\r\n  _index: true\r\n\r\n  guides:\r\n    _type: section\r\n    _readme: true\r\n\r\n  registers:\r\n    _type: registers\r\n    _readme: true\r\n    _items:\r\n      TODO.md:\r\n        _schema: todo-item\r\n      ISSUES.md:\r\n        _schema: issue-item\r\n      CHANGELOG.md:\r\n        _schema: changelog-entry\r\n`;\r\n  }\r\n\r\n  if (file === 'CLAUDE.md') {\r\n    return `# CLAUDE.md\r\n\r\nThis file provides guidance to Claude Code when working with this repository.\r\n\r\n## Project Overview\r\n\r\n**Project:** ${projectName}\r\n**Version:** 1.0.0\r\n**Status:** Active\r\n\r\n## Quick Start\r\n\r\n\\`\\`\\`bash\r\n# Install dependencies\r\nnpm install\r\n\r\n# Run validation\r\nnpx pkf validate\r\n\\`\\`\\`\r\n\r\n## Key Files\r\n\r\n- \\`pkf.config.yaml\\` - PKF configuration\r\n- \\`docs/\\` - Documentation root\r\n\r\n## Registers\r\n\r\n- \\`docs/registers/TODO.md\\` - Pending tasks\r\n- \\`docs/registers/ISSUES.md\\` - Known issues\r\n- \\`docs/registers/CHANGELOG.md\\` - Version history\r\n\r\n---\r\n\r\n**Last Updated:** ${new Date().toISOString().split('T')[0]}\r\n`;\r\n  }\r\n\r\n  if (file === 'docs/README.md') {\r\n    return `# ${projectName} Documentation\r\n\r\nWelcome to the ${projectName} documentation.\r\n\r\n## Contents\r\n\r\n- [Guides](./guides/) - How-to guides and tutorials\r\n- [Registers](./registers/) - TODO, ISSUES, CHANGELOG\r\n\r\n## Quick Links\r\n\r\n- [TODO](./registers/TODO.md) - Current tasks\r\n- [CHANGELOG](./registers/CHANGELOG.md) - Version history\r\n\r\n---\r\n\r\n**Last Updated:** ${new Date().toISOString().split('T')[0]}\r\n`;\r\n  }\r\n\r\n  if (file === 'docs/INDEX') {\r\n    return `# Documentation Index\r\n\r\nREADME.md: Documentation hub\r\nguides/: How-to guides and tutorials\r\nregisters/: Project registers (TODO, ISSUES, CHANGELOG)\r\n`;\r\n  }\r\n\r\n  if (file.includes('registers/TODO.md')) {\r\n    return `# TODO\r\n\r\n## Quick Stats\r\n\r\n- **Total Items:** 0\r\n- **Pending:** 0\r\n- **In Progress:** 0\r\n- **Completed:** 0\r\n\r\n## Pending\r\n\r\n_No pending items._\r\n\r\n## In Progress\r\n\r\n_No items in progress._\r\n\r\n## Completed\r\n\r\n_No completed items._\r\n\r\n---\r\n\r\n**Last Updated:** ${new Date().toISOString().split('T')[0]}\r\n`;\r\n  }\r\n\r\n  if (file.includes('registers/ISSUES.md')) {\r\n    return `# Known Issues\r\n\r\n## Quick Stats\r\n\r\n- **Total Issues:** 0\r\n- **Open:** 0\r\n- **Resolved:** 0\r\n\r\n## Open Issues\r\n\r\n_No open issues._\r\n\r\n## Resolved Issues\r\n\r\n_No resolved issues._\r\n\r\n---\r\n\r\n**Last Updated:** ${new Date().toISOString().split('T')[0]}\r\n`;\r\n  }\r\n\r\n  if (file.includes('registers/CHANGELOG.md')) {\r\n    return `# Changelog\r\n\r\nAll notable changes to this project will be documented in this file.\r\n\r\nThe format is based on [Keep a Changelog](https://keepachangelog.com/),\r\nand this project adheres to [Semantic Versioning](https://semver.org/).\r\n\r\n## [Unreleased]\r\n\r\n### Added\r\n- Initial project setup\r\n- PKF documentation framework\r\n\r\n---\r\n\r\n**Last Updated:** ${new Date().toISOString().split('T')[0]}\r\n`;\r\n  }\r\n\r\n  if (file.includes('README.md')) {\r\n    const section = file.split('/')[1];\r\n    return `# ${section.charAt(0).toUpperCase() + section.slice(1)}\r\n\r\nThis directory contains ${section} documentation.\r\n\r\n---\r\n\r\n**Last Updated:** ${new Date().toISOString().split('T')[0]}\r\n`;\r\n  }\r\n\r\n  if (file.includes('INDEX')) {\r\n    return `# Index\r\n\r\nREADME.md: Section overview\r\n`;\r\n  }\r\n\r\n  return `# ${file}\\n\\nPlaceholder content.\\n`;\r\n}\r\n"],"mappings":"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","names":[]}