{"version":3,"sources":["../src/commands/build.ts"],"sourcesContent":["/**\r\n * Build Command\r\n * Wraps pkf-processor build functionality\r\n */\r\n\r\nimport { existsSync } from 'node:fs';\r\nimport { join } from 'node:path';\r\nimport { spawn } from 'node:child_process';\r\nimport chalk from 'chalk';\r\n\r\ninterface BuildOptions {\r\n  config?: string;\r\n  output?: string;\r\n  strict?: boolean;\r\n}\r\n\r\nexport async function buildCommand(options: BuildOptions): Promise<void> {\r\n  const cwd = process.cwd();\r\n  const configPath = options.config || 'pkf.config.yaml';\r\n  const outputDir = options.output || '.pkf/generated';\r\n\r\n  console.log(chalk.bold('\\nPKF Build\\n'));\r\n\r\n  // Check if config exists\r\n  if (!existsSync(join(cwd, configPath))) {\r\n    console.log(chalk.red(`✗ Configuration file not found: ${configPath}`));\r\n    console.log(chalk.gray('  Run `pkf init` to initialize PKF in this project.\\n'));\r\n    process.exit(1);\r\n  }\r\n\r\n  console.log(chalk.gray(`Config: ${configPath}`));\r\n  console.log(chalk.gray(`Output: ${outputDir}\\n`));\r\n\r\n  // Find pkf-processor CLI\r\n  const pkfProcessorPaths = [\r\n    join(cwd, 'node_modules/.bin/pkf-processor'),\r\n    join(cwd, 'node_modules/@pantheon-tech/pkf-processor/dist/cli.js'),\r\n    'pkf-processor',\r\n  ];\r\n\r\n  let pkfProcessorPath: string | null = null;\r\n  for (const p of pkfProcessorPaths) {\r\n    if (existsSync(p) || p === 'pkf-processor') {\r\n      pkfProcessorPath = p;\r\n      break;\r\n    }\r\n  }\r\n\r\n  if (!pkfProcessorPath) {\r\n    console.log(chalk.red('✗ pkf-processor not found'));\r\n    console.log(chalk.gray('  Install with: npm install @pantheon-tech/pkf-processor\\n'));\r\n    process.exit(1);\r\n  }\r\n\r\n  const args = [\r\n    'build',\r\n    '--config', join(cwd, configPath),\r\n    '--output', join(cwd, outputDir),\r\n  ];\r\n\r\n  if (options.strict) {\r\n    args.push('--strict');\r\n  }\r\n\r\n  // Use node to run the CLI if it's a .js file\r\n  const isJsFile = pkfProcessorPath.endsWith('.js');\r\n  const command = isJsFile ? 'node' : pkfProcessorPath;\r\n  const cmdArgs = isJsFile ? [pkfProcessorPath, ...args] : args;\r\n\r\n  return new Promise((resolve, reject) => {\r\n    const proc = spawn(command, cmdArgs, {\r\n      stdio: 'inherit',\r\n      cwd,\r\n    });\r\n\r\n    proc.on('close', (code) => {\r\n      if (code !== 0) {\r\n        process.exit(code || 1);\r\n      }\r\n      resolve();\r\n    });\r\n\r\n    proc.on('error', (err) => {\r\n      console.log(chalk.red('✗ Failed to run pkf-processor'));\r\n      console.log(chalk.gray(`  Error: ${err.message}\\n`));\r\n      process.exit(1);\r\n    });\r\n  });\r\n}\r\n"],"mappings":";;;AAKA,SAAS,kBAAkB;AAC3B,SAAS,YAAY;AACrB,SAAS,aAAa;AACtB,OAAO,WAAW;AAQlB,eAAsB,aAAa,SAAsC;AACvE,QAAM,MAAM,QAAQ,IAAI;AACxB,QAAM,aAAa,QAAQ,UAAU;AACrC,QAAM,YAAY,QAAQ,UAAU;AAEpC,UAAQ,IAAI,MAAM,KAAK,eAAe,CAAC;AAGvC,MAAI,CAAC,WAAW,KAAK,KAAK,UAAU,CAAC,GAAG;AACtC,YAAQ,IAAI,MAAM,IAAI,wCAAmC,UAAU,EAAE,CAAC;AACtE,YAAQ,IAAI,MAAM,KAAK,uDAAuD,CAAC;AAC/E,YAAQ,KAAK,CAAC;AAAA,EAChB;AAEA,UAAQ,IAAI,MAAM,KAAK,WAAW,UAAU,EAAE,CAAC;AAC/C,UAAQ,IAAI,MAAM,KAAK,WAAW,SAAS;AAAA,CAAI,CAAC;AAGhD,QAAM,oBAAoB;AAAA,IACxB,KAAK,KAAK,iCAAiC;AAAA,IAC3C,KAAK,KAAK,uDAAuD;AAAA,IACjE;AAAA,EACF;AAEA,MAAI,mBAAkC;AACtC,aAAW,KAAK,mBAAmB;AACjC,QAAI,WAAW,CAAC,KAAK,MAAM,iBAAiB;AAC1C,yBAAmB;AACnB;AAAA,IACF;AAAA,EACF;AAEA,MAAI,CAAC,kBAAkB;AACrB,YAAQ,IAAI,MAAM,IAAI,gCAA2B,CAAC;AAClD,YAAQ,IAAI,MAAM,KAAK,4DAA4D,CAAC;AACpF,YAAQ,KAAK,CAAC;AAAA,EAChB;AAEA,QAAM,OAAO;AAAA,IACX;AAAA,IACA;AAAA,IAAY,KAAK,KAAK,UAAU;AAAA,IAChC;AAAA,IAAY,KAAK,KAAK,SAAS;AAAA,EACjC;AAEA,MAAI,QAAQ,QAAQ;AAClB,SAAK,KAAK,UAAU;AAAA,EACtB;AAGA,QAAM,WAAW,iBAAiB,SAAS,KAAK;AAChD,QAAM,UAAU,WAAW,SAAS;AACpC,QAAM,UAAU,WAAW,CAAC,kBAAkB,GAAG,IAAI,IAAI;AAEzD,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,UAAM,OAAO,MAAM,SAAS,SAAS;AAAA,MACnC,OAAO;AAAA,MACP;AAAA,IACF,CAAC;AAED,SAAK,GAAG,SAAS,CAAC,SAAS;AACzB,UAAI,SAAS,GAAG;AACd,gBAAQ,KAAK,QAAQ,CAAC;AAAA,MACxB;AACA,cAAQ;AAAA,IACV,CAAC;AAED,SAAK,GAAG,SAAS,CAAC,QAAQ;AACxB,cAAQ,IAAI,MAAM,IAAI,oCAA+B,CAAC;AACtD,cAAQ,IAAI,MAAM,KAAK,YAAY,IAAI,OAAO;AAAA,CAAI,CAAC;AACnD,cAAQ,KAAK,CAAC;AAAA,IAChB,CAAC;AAAA,EACH,CAAC;AACH;","names":[]}