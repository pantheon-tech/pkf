{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://pkf.dev/schemas/pkf-config.schema.json",
  "title": "PKF Configuration",
  "description": "Project-level PKF configuration schema supporting the Compose Pattern",
  "type": "object",
  "required": ["version", "project"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Schema reference URI"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$",
      "description": "PKF specification version (SemVer)",
      "examples": ["1.0.0", "1.0.0-alpha.1"]
    },
    "project": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Project name",
          "examples": ["my-project", "PKF"]
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$",
          "description": "Project version (SemVer)"
        },
        "description": {
          "type": "string",
          "description": "Brief project description"
        },
        "repository": {
          "type": "string",
          "description": "Git repository URL"
        }
      },
      "additionalProperties": false
    },
    "output": {
      "type": "object",
      "description": "Build output configuration",
      "properties": {
        "dir": {
          "type": "string",
          "default": ".pkf/generated",
          "description": "Directory for generated artifacts"
        }
      },
      "additionalProperties": false
    },
    "docs": {
      "$ref": "#/definitions/composeNode",
      "description": "Documentation tree using the Compose Pattern"
    },
    "structure": {
      "type": "object",
      "description": "Legacy directory structure configuration",
      "properties": {
        "docsDir": {
          "type": "string",
          "default": "docs",
          "description": "Main documentation directory"
        },
        "archiveDir": {
          "type": "string",
          "default": "docs_archive",
          "description": "Documentation archive directory"
        },
        "registersDir": {
          "type": "string",
          "default": "docs/registers",
          "description": "Registers directory path"
        },
        "templatesDir": {
          "type": "string",
          "default": "docs/framework/templates",
          "description": "Templates directory path"
        },
        "schemasDir": {
          "type": "string",
          "default": "docs/framework/schemas",
          "description": "JSON schemas directory path"
        },
        "agentsDir": {
          "type": "string",
          "default": ".claude/agents",
          "description": "AI agent definitions directory"
        }
      },
      "additionalProperties": false
    },
    "registers": {
      "type": "object",
      "description": "Register configuration",
      "properties": {
        "todoFile": {
          "type": "string",
          "default": "TODO.md",
          "description": "TODO register filename"
        },
        "issuesFile": {
          "type": "string",
          "default": "ISSUES.md",
          "description": "Issues register filename"
        },
        "changelogFile": {
          "type": "string",
          "default": "CHANGELOG.md",
          "description": "Changelog register filename"
        },
        "idPrefix": {
          "type": "object",
          "properties": {
            "todo": { "type": "string", "default": "TODO" },
            "issue": { "type": "string", "default": "ISSUE" },
            "proposal": { "type": "string", "default": "PROP" },
            "adr": { "type": "string", "default": "ADR" }
          },
          "additionalProperties": false
        },
        "idPadding": {
          "type": "integer",
          "minimum": 1,
          "maximum": 6,
          "default": 3
        }
      },
      "additionalProperties": false
    },
    "ai": {
      "type": "object",
      "description": "AI agent configuration",
      "properties": {
        "enabled": { "type": "boolean", "default": true },
        "guidanceFile": { "type": "string", "default": "CLAUDE.md" },
        "systemPromptFile": { "type": "string", "default": ".claude/SYSTEM-PROMPT.md" },
        "customAgents": { "type": "boolean", "default": false }
      },
      "additionalProperties": false
    },
    "packages": {
      "type": "object",
      "description": "Multi-package project configuration",
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "directory": { "type": "string", "default": "packages" },
        "inheritRules": { "type": "boolean", "default": true }
      },
      "additionalProperties": false
    },
    "validation": {
      "type": "object",
      "description": "Validation configuration",
      "properties": {
        "validateSchemas": { "type": "boolean", "default": true },
        "validateLinks": { "type": "boolean", "default": true },
        "requireNavHubs": { "type": "boolean", "default": true }
      },
      "additionalProperties": false
    },
    "proposals": {
      "type": "object",
      "description": "Proposal system configuration",
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "ranges": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "min": { "type": "integer" },
              "max": { "type": "integer" },
              "description": { "type": "string" }
            }
          }
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "definitions": {
    "composeNode": {
      "type": "object",
      "description": "A node in the Compose Pattern tree",
      "properties": {
        "_type": {
          "type": "string",
          "enum": ["root", "section", "document", "register"],
          "description": "Node type defining behavior"
        },
        "_readme": {
          "type": "boolean",
          "description": "Whether to generate/require README.md"
        },
        "_index": {
          "type": "boolean",
          "description": "Whether to generate/require INDEX file"
        },
        "_description": {
          "type": "string",
          "description": "Description of this section/document"
        },
        "_schema": {
          "type": "string",
          "description": "Schema to validate items against"
        },
        "_items": {
          "$ref": "#/definitions/itemsPattern",
          "description": "Pattern for dynamic items in this section"
        }
      },
      "additionalProperties": {
        "oneOf": [
          { "$ref": "#/definitions/composeNode" },
          { "type": "string" }
        ]
      }
    },
    "itemsPattern": {
      "type": "object",
      "description": "Pattern definition for dynamic items",
      "properties": {
        "_type": {
          "type": "string",
          "enum": ["document", "register"],
          "description": "Type of items in this section"
        },
        "_schema": {
          "type": "string",
          "description": "Schema to validate items against"
        }
      },
      "additionalProperties": false
    }
  }
}
